\section{Spicey: An ER-based Web Framework}
\label{sec-spicey}

Spicey\index{Spicey} is a framework to support the implementation of
web-based systems in Curry. Spicey generates an initial implementation
from an entity-relationship (ER) description of the underlying
data. The generated implementation contains operations to create and
manipulate entities of the data model, supports authentication,
authorization, session handling, and the composition of individual
operations to user processes. Furthermore, the implementation ensures
the consistency of the database w.r.t. the data dependencies specified
in the ER model, i.e., updates initiated by the user cannot lead to an
inconsistent state of the database.

The idea of this tool, which is part of the distribution of \CYS,
is described in detail in \cite{HanusKoschnicke10PADL}.
Thus, we describe only the basic steps to use this tool
in order to generate a web application.

First, one has to create a textual description of the
entity-relationship model
as a Curry term of type \code{ERD}
(w.r.t.\ the type definitions given in module
\code{\cyshome/currytools/erd2curry/ERD.curry})
and store it in some file, e.g., \ccode{mymodel.erdterm}.
The directory \code{\cyshome/currytools/spicey/}
contains two examples for such ERD term files:
\begin{description}
\item[\code{Blog.erdterm}:]
This is a simple ER model for a blog with entries, comments,
and tags, as presented in the paper \cite{HanusKoschnicke10PADL}.
\item[\code{Uni.erdterm}:]
This is an ER model for university lectures as
presented in the paper \cite{BrasselHanusMueller08PADL}.
\end{description}
%
Then change to the directory in which you want to create
the project sources.
Execute the command\pindex{spiceup}
\begin{curry}
spiceup .../mymodel.erdterm
\end{curry}
with the path to the ERD term file as a parameter
(\code{spiceup} is a program stored in \code{\cyshome/bin}
where \cyshome is the installation directory of \CYS;
see Section~\ref{sec-general}).
You can also provide a path name, i.e., the name of a directory,
where the database files should be stored, e.g.,
\begin{curry}
spiceup --dbpath DBDIR .../mymodel.erdterm
\end{curry}
If the parameter \ccode{--dbpath DBDIR} is not provided,
then DBDIR is set to the current directory (\ccode{.}).
Since this specification will be used in the \emph{generated} web programs,
a relative database directory name will be relative to the place where
the web programs are stored.
In order to avoid such confusion, it might be better to specify
an absolute path name for the database directory.

After the generation of this project (see the generated file
\code{README.txt} for information about the generated project structure),
one can compile the generated programs by
\begin{curry}
scripts/compile.sh
\end{curry}
In order to generate the executable web application,
configure and execute the shell script \code{scripts/deploy.sh}.
In particular, you should define the variable
\code{WEBSERVERDIR} in this script for the target directory
where the compiled cgi programs should be stored.
After the successful compilation with this script,
the application is executable
in a web browser by selecting the URL \code{<URL of web dir>/spicey.cgi}.
